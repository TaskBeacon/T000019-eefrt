# ============================================================================
# Scripted sim config
# - Used by: python main.py sim --config config/config_scripted_sim.yaml
# - Scope: scripted simulation only (contains sim section; no qa section)
# - Profile: short deterministic smoke run
# ============================================================================

# === Subject Form ===========================================================
subinfo_fields:
  - name: subject_id
    type: int
    constraints:
      min: 101
      max: 999
      digits: 3

subinfo_mapping:
  subject_id: SIM编号
  Participant Information: 模拟信息
  registration_failed: 注册失败
  registration_successful: 注册成功
  invalid_input: "{field} 输入无效"


# === Display / Window =======================================================
window:
  size: [1280, 720]
  units: pix
  screen: 0
  bg_color: black
  fullscreen: false
  monitor_width_cm: 35.5
  monitor_distance_cm: 60


# === Task ===================================================================
task:
  task_name: eefrt
  save_path: ./outputs/sim
  language: Chinese
  voice_name: zh-CN-YunyangNeural
  voice_enabled: false
  total_blocks: 1
  total_trials: 12
  trial_per_block: 12
  conditions: [offer]
  key_list: ["f", "j", "space"]
  choice_keys: ["f", "j"]
  effort_key: "space"
  easy_reward: 1.00
  easy_required_presses: 8
  hard_required_presses: 14
  easy_time_limit_s: 1.0
  hard_time_limit_s: 1.8
  seed_mode: same_across_sub
  delta: 1


# === Timing =================================================================
timing:
  cue_duration: 0.2
  anticipation_duration: 0.8
  ready_duration: 0.2
  feedback_duration: 0.2
  reward_feedback_duration: 0.2
  iti_duration: 0.2


# === Stimuli ================================================================
stimuli:
  fixation:
    type: text
    font: SimHei
    text: "+"
    color: white
    height: 46

  instruction_text:
    type: text
    font: SimHei
    text: |
      EEfRT（脚本模拟）
      按空格键开始。
    color: white
    height: 30
    wrapWidth: 900

  choice_header:
    type: text
    font: SimHei
    text: |
      概率：{probability_pct}%
      请在 0.8 秒内做出选择
    color: white
    height: 30
    pos: [0, 250]
    wrapWidth: 900

  choice_left:
    type: text
    font: SimHei
    text: |
      低努力
      {easy_deadline_s} 秒 / {easy_presses} 次
      ¥{easy_reward}
    color: cyan
    height: 30
    pos: [-300, 10]
    wrapWidth: 420

  choice_right:
    type: text
    font: SimHei
    text: |
      高努力
      {hard_deadline_s} 秒 / {hard_presses} 次
      ¥{hard_reward}
    color: orange
    height: 30
    pos: [300, 10]
    wrapWidth: 420

  ready_text:
    type: text
    font: SimHei
    text: |
      {choice_label}
      目标：{required_presses} 次（{time_limit_s} 秒）
    color: cyan
    height: 30
    wrapWidth: 900

  effort_prompt:
    type: text
    font: SimHei
    text: |
      {choice_label}
      按 {effort_key} 键
      目标：{required_presses} 次（{time_limit_s} 秒）
    color: white
    height: 24
    pos: [0, 195]
    wrapWidth: 900

  effort_counter:
    type: text
    font: SimHei
    text: |
      按键进度：{current_presses}/{required_presses}
      剩余时间：{time_left_s} 秒
    color: yellow
    height: 24
    pos: [0, -190]
    wrapWidth: 900

  effort_success_feedback:
    type: text
    font: SimHei
    text: "任务完成"
    color: green
    height: 38

  effort_fail_feedback:
    type: text
    font: SimHei
    text: "任务未完成"
    color: red
    height: 38

  reward_win_feedback:
    type: text
    font: SimHei
    text: "中奖，获得 ¥{reward_amount}"
    color: green
    height: 38

  reward_nowin_feedback:
    type: text
    font: SimHei
    text: "未中奖，本试次奖励 ¥0.00"
    color: orange
    height: 34

  reward_incomplete_feedback:
    type: text
    font: SimHei
    text: "未完成任务，本试次奖励 ¥0.00"
    color: red
    height: 34

  block_break:
    type: text
    font: SimHei
    text: |
      脚本模拟区块结束
      高努力选择率：{hard_rate:.1%}
      努力完成率：{completion_rate:.1%}
      奖励：¥{total_reward}

      按空格键继续
    color: white
    height: 24
    wrapWidth: 900

  good_bye:
    type: text
    font: SimHei
    text: |
      脚本模拟完成
      总奖励：¥{total_reward}

      按空格键退出
    color: white
    height: 28
    wrapWidth: 900


# === Triggers ===============================================================
triggers:
  map:
    exp_onset: 1
    exp_end: 2
    block_onset: 10
    block_end: 11
    cue_onset: 20
    choice_onset: 30
    choice_easy_press: 31
    choice_hard_press: 32
    choice_no_response: 33
    choice_forced: 34
    ready_onset: 40
    target_onset: 50
    target_key_press: 51
    target_complete: 52
    target_fail: 53
    feedback_onset: 60
    reward_win_onset: 70
    reward_nowin_onset: 71
    reward_incomplete_onset: 72
    iti_onset: 80

  driver:
    type: serial_url
    url: loop://
    baudrate: 115200

  timing:
    post_delay_ms: 1

  policy:
    strict: false


# === Trial Controller =======================================================
controller:
  probability_levels: [0.12, 0.50, 0.88]
  hard_reward_levels: [1.50, 2.80, 4.30]
  randomize_order: true
  no_choice_hard_prob: 0.50
  enable_logging: true


# === Sim ====================================================================
sim:
  output_dir: outputs/sim
  seed: 0
  participant_id: sim001
  session_id: sub-sim001_task-eefrt_seed0
  log_path: outputs/sim/sub-sim001_task-eefrt_seed0_sim_events.jsonl
  policy: warn
  default_rt_s: 0.2
  clamp_rt: false
  responder:
    type: scripted
    kwargs:
      key: space
      rt_s: 0.18
